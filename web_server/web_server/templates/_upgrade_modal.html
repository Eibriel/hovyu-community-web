{% macro upgrade_modal() %}
<!-- Upgrade Modal -->
    <div class="modal fade" id="upgradeModal" tabindex="-1" role="dialog" aria-labelledby="upgradeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="upgradeModalLabel">{{ _('Add Badge') }}</h4>
                </div>
                <div class="modal-body">
                    <p>{{ _('Add a badge to the entity so it stand out!') }} <strong>{{ _('Paying one year you get 2 months!') }}</strong></p>
                    <p>{{ _('Step 1 of 2') }}</p>

                    <div class="form-horizontal">
                        <!-- Badge -->
                        <div class="form-group">
                            <label for="payment_badge" class="col-sm-2 control-label">{{ _('Badge') }}</label>
                            <div class="col-sm-10">
                                <select class="form-control"  id="payment_badge">
                                    <option value="recycling">{{ _('Recycling') }}</option>
                                    <option value="clean_energy">{{ _('Clean Energy') }}</option>
                                    <option value="organic">{{ _('Organic') }}</option>
                                    <option value="vegan">{{ _('Vegan') }}</option>
                                    <option value="kosher">{{ _('Kosher') }}</option>
                                    <option value="gluten_free">{{ _('Gluten Free') }}</option>
                                    <option value="cruelty_free">{{ _('Cruelty Free') }}</option>
                                    <option value="free_software">{{ _('Free Software') }}</option>
                                    <option value="free_hardware">{{ _('Free Hardware') }}</option>
                                    <option value="creative_commons">{{ _('Creative Commons') }}</option>
                                </select>
                                <span id="new_store_badge_help" class="help-block">{{ _('Badge you want to add to the entity') }}</span>
                            </div>
                        </div>
                        <!-- Country -->
                        <div class="form-group">
                            <label for="payment_country" class="col-sm-2 control-label">{{ _('Country') }}</label>
                            <div class="col-sm-10">
                                <select class="form-control"  name="country" id="payment_country">
                                    <option value="ar">{{ _('Argentina') }}</option>
                                    <option value="br">{{ _('Brazil') }}</option>
                                    <option value="co">{{ _('Colombia') }}</option>
                                    <option value="ve">{{ _('Venezuela') }}</option>
                                    <option value="mx">{{ _('Mexico') }}</option>
                                    <option value="">{{ _('Others') }}</option>
                                </select>
                                <span id="new_store_name_help" class="help-block">{{ _('Country from which payment will be made') }}</span>
                            </div>
                        </div>
                        <!-- Months -->
                        <div class="form-group">
                            <label for="new_store_name" class="col-sm-2 control-label">{{ _('Months') }}</label>
                            <div class="col-sm-10">
                                <input type="number" name="months" id="payment_months" class="form-control" placeholder="" value="12" required></input>
                                <span id="new_store_name_help" class="help-block">{{ _('For how long do you want to keep the Badge?') }}</span>
                            </div>
                        </div>
                        <!-- Total -->
                        <div class="form-group">
                            <label for="payment_amount_to_pay" class="col-sm-2 control-label">{{ _('Total to pay') }}</label>
                            <div class="col-sm-10">
                                <input type="text" id="payment_amount_to_pay" class="form-control" placeholder="0" value="2000" disabled></input>
                                <span id="new_store_name_help" class="help-block">{{ _('Total amount you should pay') }}</span>
                            </div>
                        </div>
                        <!-- Saving -->
                        <div class="form-group">
                            <label for="payment_amount_saved" class="col-sm-2 control-label">{{ _('Total saving') }}</label>
                            <div class="col-sm-10">
                                <input type="text" id="payment_amount_saved" class="form-control" placeholder="0" value="400" disabled></input>
                                <span id="new_store_name_help" class="help-block">{{ _('How much are you saving keeping the Badge for several months') }}</span>
                            </div>
                        </div>
                        <!-- Payment Method -->
                        <div class="form-group">
                            <label for="method_radio" class="col-sm-2 control-label">{{_('Payment method') }}</label>
                            <div class="col-sm-10">
                                <div class="btn-group" data-toggle="buttons" id="method_radio">
                                  <!--<label class="btn btn-primary active disabled">
                                    <input type="radio" name="method" id="payment_pagomiscuentas" autocomplete="off" value="pagomiscuentas"> PagoMisCuentas
                                  </label>-->
                                  <label class="btn btn-primary active" id="payment_mercadopago_label">
                                    <input type="radio" name="method" id="payment_mercadopago" autocomplete="off" value="mercadopago" checked> {{ _('MercadoPago') }}
                                  </label>
                                  <label class="btn btn-primary" id="payment_local_bank_label">
                                    <input type="radio" name="method" id="payment_local_bank" autocomplete="off" value="local_bank"> {{ _('Wire Transfer') }}
                                  </label>
                                  <label class="btn btn-primary" id="payment_bitcoin_label">
                                    <input type="radio" name="method" id="payment_bitcoin" autocomplete="off" value="bitcoin"> {{ _('Bitcoin') }}
                                  </label>
                                </div>
                                <span id="new_store_name_help" class="help-block">{{ _('Select payment method') }}</span>
                            </div>
                        </div>
                        <!-- EMail -->
                        <div class="form-group">
                            <label for="payment_email" class="col-sm-2 control-label">{{ _('EMail') }}</label>
                            <div class="col-sm-10">
                                <input type="email" name="email" id="payment_email" class="form-control" placeholder="{{ _('your@email.com') }}" value=""></input>
                                <span id="new_store_name_help" class="help-block">{{ _('Send payment instructions to this EMail') }}</span>
                            </div>
                        </div>
                        <!-- Send -->
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="submit" class="btn btn-success" onclick="send_payment_instructions();">{{ _('Send') }}</button>
                                <!--<button type="button" class="btn btn-success" data-dismiss="modal">{{ _('Send') }}</button>-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="hidden" id="upgrade_store_id" value=""/>
                    <input type="hidden" id="upgrade_store_iid" value=""/>
                    <input type="hidden" id="upgrade_store_name" value=""/>
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
                    <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro upgrade_modal_js() %}
<script>
function add_high(id, iid, name) {
    //$('#panel_store_'+id).addClass('panel-primary');
    //$('#panel_store_'+id).removeClass('panel-default');
    //$('#star_'+id).css('display', 'inline');

    $('#upgrade_store_id').val(id);
    $('#upgrade_store_iid').val(iid);
    $('#upgrade_store_name').val(name);

    redraw_upgrade_modal();
}

function redraw_upgrade_modal() {
    var country = $('#payment_country').val();
    //var product = $('input[name=product]:checked', '#product_radio').val();
    var months = $('#payment_months').val();

    if (months < 1 || isNaN(months)) {
        months = 1;
        $('#payment_months').val(months);
    }

    months = parseInt(months, 10);
    $('#payment_months').val(months);

    $('#payment_local_bank_label').removeClass('disabled');
    $('#payment_mercadopago_label').removeClass('disabled');
    $('#payment_bitcoin_label').removeClass('disabled');

    var ars_month = 200;
    var usd_month = 20;
    var btc_month = 0.08;

    var saving = Math.floor(months/12)*2;

    var ars = (ars_month*months) - (ars_month*saving);
    var usd = (usd_month*months) - (usd_month*saving);
    var btc = (btc_month*months) - (btc_month*saving);

    //if (product == 'highlight_one_year') {
    ars_pay = 'ARS '+ars;
    ars_saving = 'ARS '+(ars_month*saving);
    usd_pay = 'USD '+usd;
    usd_saving = 'USD '+(usd_month*saving);
    btc_pay = 'BTC '+btc;
    btc_saving = 'BTC '+(btc_month*saving);
    //} else if (product == 'highlight_one_month') {
    //ars_pay = 'ARS 200.0';
    //ars_saving = 'ARS 0.0';
    //usd_pay = 'USD 20.0';
    //usd_saving = 'USD 0.0';
    //btc_pay = 'BTC 0.08';
    //btc_saving = 'BTC 0.0';
    //}

    $('#payment_amount_to_pay').val(usd_pay);
    $('#payment_amount_saved').val(usd_saving);

    if (country == '') {
        $('#payment_local_bank_label').addClass('disabled');
        $('#payment_mercadopago_label').addClass('disabled');
        $('#payment_bitcoin').prop('checked', true);
        $('#payment_mercadopago').prop('checked', false);
        $('#payment_local_bank').prop('checked', false);
        $('#payment_bitcoin_label').addClass('active');
        $('#payment_mercadopago_label').removeClass('active');
        $('#payment_local_bank_label').removeClass('active');
    } else if (country == 'ar') {
        $('#payment_amount_to_pay').val(ars_pay);
        $('#payment_amount_saved').val(ars_saving);
    } else {
        $('#payment_local_bank_label').addClass('disabled');
        $('#payment_mercadopago').prop('checked', true);
        $('#payment_bitcoin').prop('checked', false);
        $('#payment_local_bank').prop('checked', false);
        $('#payment_mercadopago_label').addClass('active');
        $('#payment_bitcoin_label').removeClass('active');
        $('#payment_local_bank_label').removeClass('active');
    }

    var method = $('input[name=method]:checked', '#method_radio').val();

    //console.log(method);
    if (method == 'bitcoin') {
        $('#payment_amount_to_pay').val(btc_pay);
        $('#payment_amount_saved').val(btc_saving);
    }

}

$('#payment_country').change(redraw_upgrade_modal);
//
//$('#payment_year').change(redraw_upgrade_modal);
$('#payment_months').change(redraw_upgrade_modal);
//
$('#payment_mercadopago').change(redraw_upgrade_modal);
$('#payment_local_bank').change(redraw_upgrade_modal);
$('#payment_bitcoin').change(redraw_upgrade_modal);

function send_payment_instructions() {
    var method = $('input[name=method]:checked', '#method_radio').val();
    //var product = $('input[name=product]:checked', '#product_radio').val();
    var country = $('#payment_country').val();
    var email = $('#payment_email').val();
    var badge = $('#payment_badge').val();
    var months = $('#payment_months').val();
    var id = $('#upgrade_store_id').val();
    var iid = $('#upgrade_store_iid').val();
    var name = $('#upgrade_store_name').val();

    $.ajax({
      method: "GET",
      url: "/send_payment_instructions",
      type: "json",
      data: { email: email,
              method: method,
              //product: product,
              country: country,
              badge: badge,
              months: months,
              id: id,
              iid: iid,
              name: name }
    })
      .done(function( msg ) {});

    $('#upgradeModal').modal('hide')
}

</script>
{% endmacro %}
